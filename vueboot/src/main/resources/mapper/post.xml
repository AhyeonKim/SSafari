<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ssafy.post">

	<select id="getPosts"
		resultType="com.ssafy.edu.vue.dto.Post">
		SELECT P.POSTID POSTID, P.TITLE TITLE, P.BODY BODY, P.CREATED_AT CREATED_AT, P.MEMBERID MEMBERID, IF(P.ANONYMOUS=1, '익명', M.USERNAME) AS USERNAME 
		FROM POSTS P, MEMBERS M 
		WHERE P.MEMBERID=M.MEMBERID 
		ORDER BY POSTID	DESC
	</select>

	<select id="getPostList"
		parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.vue.dto.Post">
		SELECT P.POSTID POSTID, P.TITLE TITLE, P.BODY BODY, P.CREATED_AT CREATED_AT, P.MEMBERID MEMBERID, M.USERNAME USERNAME 
		FROM POSTS P, MEMBERS M 
		WHERE P.MEMBERID=M.MEMBERID AND P.MEMBERID=#{memberid} 
		ORDER BY POSTID	DESC
	</select>

	<select id="getPost" parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.vue.dto.Post">
		SELECT P.POSTID POSTID, P.TITLE TITLE, P.BODY BODY, P.CREATED_AT CREATED_AT, P.MEMBERID MEMBERID, IF(P.ANONYMOUS=1, '익명', M.USERNAME) AS USERNAME 
		FROM POSTS P, MEMBERS M 
		WHERE P.MEMBERID=M.MEMBERID AND POSTID = #{postid}
	</select>

	<insert id="addPost"
		parameterType="com.ssafy.edu.vue.dto.Post">
		INSERT INTO
		POSTS(TITLE, BODY, CREATED_AT, MEMBERID, CATEGORYID, ANONYMOUS, LOCATIONID)
		VALUES(#{title},#{body},now(), #{memberid}, #{categoryid}, #{anonymous}, #{locationid})
	</insert>
	
	<update id="updatePost"
		parameterType="com.ssafy.edu.vue.dto.Post">
		UPDATE POSTS SET
		TITLE=#{title},
		BODY=#{body},
		CREATED_AT=now()
		WHERE
		POSTID=#{postid}
	</update>

	<delete id="deletePost" parameterType="java.lang.Integer">
		DELETE FROM POSTS WHERE
		POSTID
		= #{postid}
	</delete>
	
	
	<select id="getCommentPost"
		parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.vue.dto.Commentpost">
		SELECT C.CPOSTID CPOSTID, C.POSTID POSTID, 
		C.MEMBERID MEMBERID, IF(C.ANONYM=1, '익명', M.USERNAME) AS USERNAME, 
		C.WDATE WDATE, C.CONTENT CONTENT, C.ANONYM ANONYM
FROM COMMENTPOST C, MEMBERS M 
WHERE C.POSTID=#{postid} AND M.MEMBERID=C.MEMBERID ORDER BY C.CPOSTID
	</select>
	
	<insert id="addCommentPost"
		parameterType="com.ssafy.edu.vue.dto.Commentpost">
		INSERT INTO
		COMMENTPOST(POSTID, MEMBERID, WDATE, CONTENT, ANONYM)
		VALUES(#{postid},#{memberid},now(), #{content}, #{anonym})
	</insert>
	
	<update id="updateCommentPost"
		parameterType="com.ssafy.edu.vue.dto.Commentpost">
		UPDATE COMMENTPOST SET
		CONTENT=#{content},
		WDATE=now(),
		ANONYM=#{anonym}
		WHERE
		CPOSTID=#{cpostid}
	</update>

	<delete id="deleteCommentPost" parameterType="java.lang.Integer">
		DELETE FROM COMMENTPOST WHERE
		CPOSTID
		= #{cpostid}
	</delete>
	
	<select id="getCategoryPosts"
		parameterType="java.lang.Integer"
		resultType="com.ssafy.edu.vue.dto.Post">
		SELECT P.POSTID POSTID, P.TITLE TITLE, P.BODY BODY, P.CREATED_AT CREATED_AT, P.MEMBERID MEMBERID, P.ANONYMOUS ANONYMOUS, M.USERNAME USERNAME 
		FROM POSTS P, MEMBERS M 
		WHERE P.MEMBERID=M.MEMBERID AND P.CATEGORYID=#{categoryid}
		ORDER BY POSTID	DESC
	</select>
	
	<select id="getLocationPosts"
		parameterType="com.ssafy.edu.vue.dto.LocationFiltering"
		resultType="com.ssafy.edu.vue.dto.Post">
		SELECT P.POSTID POSTID, P.TITLE TITLE, P.BODY BODY, P.CREATED_AT CREATED_AT, P.MEMBERID MEMBERID, P.ANONYMOUS ANONYMOUS, M.USERNAME USERNAME 
		FROM POSTS P, MEMBERS M 
		WHERE P.MEMBERID=M.MEMBERID 
		ORDER BY POSTID	DESC AND P.CATEGORYID=#{categoryid} AND P.LOCATIONID=#{locationid}
	</select>
	
	<insert id="addLikePost" parameterType="com.ssafy.edu.vue.dto.Likepost">
		INSERT INTO
		LIKEPOST(POSTID, MEMBERID)
		VALUES(#{postid},#{memberid})
	</insert>
	
	<delete id="deleteLikePost" parameterType="com.ssafy.edu.vue.dto.Likepost">
		DELETE FROM COMMENTPOST WHERE POSTID = #{postid} AND MEMBERID=#{memberid}
	</delete>
	
	<select id="getLikeCounts" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM LIKEPOST
		WHERE POSTID = #{postid}
	</select>
	
	<select id="getCommentCounts" parameterType="java.lang.Integer" resultType="java.lang.Integer">
		SELECT COUNT(*) FROM COMMENTPOST
		WHERE POSTID = #{postid}
	</select>
</mapper>
